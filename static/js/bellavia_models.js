// Submit Button handler
function handleSubmit() {
  // Prevent the page from refreshing
  d3.event.preventDefault();

  // Select the input value from the form
  var city = d3.select("#city").node().value;
  console.log(city);

  // clear the input value
  d3.select("#city").node().value = "";

  // Build the plot with the new stock
  buildPlot(city);
}

function buildPlot(city) {
  var url = "/api/1/rent_data";

  d3.json(url, function (response) {
    // Grab values from the response json object to build the plots
    var name = city;

    console.log(response);
    var years = [];
    var prices = [];
    var prices_labels = [];
    for (var i = 0; i < response[0].Year.length; i++) {
  
      if (response[0].City[i] == name) {
        years.push(response[0].Year[i]);
        prices.push(response[0].Price[i]);
        prices_labels.push(`Average Rent: $${response[0].Price[i]}`)
      }
    }

    var trace1 = {
      type: "scatter",
      mode: "lines+markers",
      name: name,
      x: years,
      y: prices,
      text: prices_labels,
      line: {
        color: "#17BECF"
      },
    };

    var data = [trace1];

    var layout = {
      title: `${city} Rent Index Over Time`,
      xaxis: {
        range: [years[0], years[-1]],
        type: "date"
      },
      yaxis: {
        autorange: true,
        type: "linear"
      },
      height: 800,
      width: 800
    };

    Plotly.newPlot("plot-mary", data, layout);

  });
}

// Add event listener for submit button
d3.select("#submit").on("click", handleSubmit);

var autocomplete = new autoComplete({
  selector: '#citySearchBox',
  minChars: 1,
  source: function (term, suggest) {
      term = term.toLowerCase();
      var choices = [
          "United States",
          "New York",
          "Los Angeles-Long Beach-Anaheim",
          "Chicago",
          "Dallas-Fort Worth",
          "Philadelphia",
          "Houston",
          "Washington",
          "Miami-Fort Lauderdale",
          "Atlanta",
          "Boston",
          "San Francisco",
          "Detroit",
          "Riverside",
          "Phoenix",
          "Seattle",
          "Minneapolis-St Paul",
          "San Diego",
          "St. Louis",
          "Tampa",
          "Baltimore",
          "Denver",
          "Pittsburgh",
          "Portland",
          "Charlotte",
          "Sacramento",
          "San Antonio",
          "Orlando",
          "Cincinnati",
          "Cleveland",
          "Kansas City",
          "Las Vegas",
          "Columbus",
          "Indianapolis",
          "San Jose",
          "Austin",
          "Virginia Beach",
          "Nashville",
          "Providence",
          "Milwaukee",
          "Jacksonville",
          "Memphis",
          "Oklahoma City",
          "Louisville-Jefferson County",
          "Hartford",
          "Richmond",
          "New Orleans",
          "Buffalo",
          "Raleigh",
          "Birmingham",
          "Salt Lake City",
          "Rochester",
          "Grand Rapids",
          "Tucson",
          "Urban Honolulu",
          "Tulsa",
          "Fresno",
          "Worcester",
          "Stamford",
          "Albuquerque",
          "Albany",
          "Omaha",
          "New Haven",
          "Bakersfield",
          "Knoxville",
          "Greenville",
          "Ventura",
          "Allentown",
          "El Paso",
          "Baton Rouge",
          "Dayton",
          "McAllen",
          "Columbia",
          "Greensboro",
          "Akron",
          "North Port-Sarasota-Bradenton",
          "Little Rock",
          "Stockton",
          "Charleston",
          "Syracuse",
          "Colorado Springs",
          "Winston-Salem",
          "Wichita",
          "Springfield",
          "Fort Myers",
          "Boise City",
          "Toledo",
          "Madison",
          "Lakeland",
          "Ogden",
          "Daytona Beach",
          "Des Moines",
          "Jackson",
          "Youngstown",
          "Augusta",
          "Scranton",
          "Harrisburg",
          "Melbourne",
          "Chattanooga",
          "Spokane",
          "Provo",
          "Lancaster",
          "Modesto",
          "Portland",
          "Durham",
          "Santa Rosa",
          "Lexington",
          "Lafayette",
          "Lansing",
          "Fayetteville",
          "Pensacola",
          "Visalia",
          "Shreveport",
          "Springfield",
          "York",
          "Corpus Christi",
          "Flint",
          "Reno",
          "Asheville",
          "Port St. Lucie",
          "Santa Maria-Santa Barbara",
          "Huntsville",
          "Fort Wayne",
          "Salinas",
          "Vallejo",
          "Mobile",
          "Reading",
          "Brownsville",
          "Killeen",
          "Canton",
          "Beaumont",
          "Manchester",
          "Salem",
          "Anchorage",
          "Davenport",
          "Peoria",
          "Myrtle Beach",
          "Montgomery",
          "Salisbury",
          "Gulfport",
          "Tallahassee",
          "Trenton",
          "Fayetteville",
          "Hickory",
          "Huntington",
          "Eugene",
          "Rockford",
          "Savannah",
          "Ann Arbor",
          "Ocala",
          "Kalamazoo",
          "Naples",
          "South Bend",
          "Spartanburg",
          "Evansville",
          "Kingsport",
          "Roanoke",
          "Green Bay",
          "Lincoln",
          "Fort Collins",
          "Utica",
          "Columbus",
          "Boulder",
          "Lubbock",
          "Erie",
          "Fort Smith",
          "Duluth",
          "Atlantic City",
          "New London",
          "San Luis Obispo",
          "Gainesville",
          "Santa Cruz",
          "Clarksville",
          "Cedar Rapids",
          "Merced",
          "Wilmington",
          "Kennewick",
          "Greeley",
          "Waco",
          "Olympia",
          "Amarillo",
          "Binghamton",
          "Hagerstown",
          "Bremerton",
          "Laredo",
          "Lynchburg",
          "Yakima",
          "Crestview-Fort Walton Beach-Destin",
          "Topeka",
          "Macon-Bibb County",
          "Champaign-Urbana",
          "Tuscaloosa",
          "College Station",
          "Sioux Falls",
          "Charleston",
          "Appleton",
          "Chico",
          "Charlottesville",
          "Claremont",
          "Barnstable Town",
          "Longview",
          "Burlington",
          "Prescott",
          "Springfield",
          "Tyler",
          "Las Cruces",
          "Fargo",
          "Houma",
          "Rochester",
          "Florence",
          "Medford",
          "Lafayette-West Lafayette",
          "Bellingham",
          "Lake Havasu City",
          "Saginaw",
          "Lake Charles",
          "Johnson City",
          "Elkhart",
          "Yuma",
          "Racine",
          "Athens",
          "Torrington",
          "St. Cloud",
          "Hilton Head Island",
          "Bloomington",
          "Hilo",
          "Panama City",
          "Kingston",
          "Daphne",
          "Gainesville",
          "Warner Robins",
          "Blacksburg",
          "Jacksonville",
          "Redding",
          "Monroe",
          "Joplin",
          "El Centro",
          "Terre Haute",
          "Muskegon",
          "East Stroudsburg",
          "Sioux City",
          "Greenville",
          "Waterloo",
          "Oshkosh",
          "Yuba City",
          "Abilene",
          "Columbia",
          "Dover",
          "Eau Claire",
          "Janesville",
          "Jackson",
          "Punta Gorda",
          "Bloomington",
          "Pueblo",
          "Billings",
          "Bowling Green",
          "Bend",
          "Albany",
          "Vineland",
          "Niles",
          "Kahului",
          "Ottawa",
          "State College",
          "Bangor",
          "Alexandria",
          "Decatur",
          "Hanford",
          "Iowa City",
          "Rocky Mount",
          "Monroe",
          "Wichita Falls",
          "Madera",
          "Jefferson City",
          "Chambersburg",
          "Texarkana",
          "Elizabethtown",
          "Pottsville",
          "Wheeling",
          "Florence",
          "Grand Junction",
          "Concord",
          "Dothan",
          "Santa Fe",
          "Johnstown",
          "Traverse City",
          "Hattiesburg",
          "Dalton",
          "Midland",
          "Homosassa Springs",
          "Auburn",
          "Valdosta",
          "Coeur d'Alene",
          "Springfield",
          "St. George",
          "Vero Beach",
          "Odessa",
          "Napa",
          "Tupelo",
          "Battle Creek",
          "Jamestown",
          "Eureka",
          "Rapid City",
          "Flagstaff",
          "Wausau",
          "La Crosse",
          "Lebanon",
          "Idaho Falls",
          "Pittsfield",
          "Lawton",
          "Farmington",
          "Jackson",
          "Morgantown",
          "Glens Falls",
          "Winchester",
          "St. Joseph",
          "Altoona",
          "New Bern",
          "Carbondale",
          "London",
          "Logan",
          "Harrisonburg",
          "Beckley",
          "Mansfield",
          "Weirton",
          "Goldsboro",
          "Augusta",
          "Hammond",
          "Jonesboro",
          "Sherman",
          "Anniston",
          "Staunton",
          "Muncie",
          "Mount Vernon",
          "Albany",
          "Watertown",
          "Williamsport",
          "Cleveland",
          "Sheboygan",
          "Bismarck",
          "Owensboro",
          "Dunn",
          "Wooster",
          "Morristown",
          "Kankakee",
          "Brunswick",
          "Ogdensburg",
          "San Angelo",
          "Michigan City",
          "Holland",
          "Wenatchee",
          "Lawrence",
          "Decatur",
          "Missoula",
          "Salem",
          "Bay City",
          "Lewiston",
          "Roseburg",
          "Sumter",
          "Meridian",
          "Show Low",
          "Bluefield",
          "Danville",
          "Lima",
          "Cookeville",
          "California-Lexington Park",
          "Gadsden",
          "Cumberland",
          "Longview",
          "Whitewater",
          "Fond du Lac",
          "Ithaca",
          "Ashtabula",
          "Gettysburg",
          "Pine Bluff",
          "Tullahoma",
          "Richmond",
          "Adrian",
          "Twin Falls",
          "Corning",
          "Sebring",
          "Truckee",
          "Paducah",
          "Grand Forks",
          "Shelby",
          "Fairbanks",
          "Ocean City",
          "Mankato",
          "Rome",
          "Cape Girardeau",
          "Hot Springs",
          "Greenwood",
          "Sunbury",
          "Clarksburg",
          "Talladega",
          "Dubuque",
          "The Villages",
          "Albertville",
          "Manhattan",
          "Parkersburg",
          "New Philadelphia",
          "Orangeburg",
          "Cheyenne",
          "New Castle",
          "Brainerd",
          "Kalispell",
          "Sevierville",
          "Ames",
          "Bozeman",
          "Moses Lake",
          "Indiana",
          "Elmira",
          "Meadville",
          "Beaver Dam",
          "Pinehurst-Southern Pines",
          "Ukiah",
          "Hermiston-Pendleton",
          "Lufkin",
          "Zanesville",
          "Corvallis",
          "Bloomsburg",
          "Laurel",
          "Russellville",
          "Branson",
          "Watertown",
          "Midland",
          "Opelousas",
          "Pocatello",
          "Kokomo",
          "Grants Pass",
          "Huntsville",
          "Plattsburgh",
          "Grand Island",
          "DuBois",
          "Danville",
          "Manitowoc",
          "Great Falls",
          "Wilson",
          "Cullman",
          "Olean",
          "Auburn",
          "Portsmouth",
          "Athens",
          "Oak Harbor",
          "Chillicothe",
          "Hinesville",
          "Somerset",
          "Warsaw",
          "Stillwater",
          "Quincy",
          "Keene",
          "Sandusky",
          "Searcy",
          "Columbus",
          "Roanoke Rapids",
          "Centralia",
          "Casper",
          "Helena",
          "Findlay",
          "Wisconsin Rapids-Marshfield",
          "Palatka",
          "Seneca",
          "Mount Airy",
          "Glenwood Springs",
          "Aberdeen",
          "Gallup",
          "Port Angeles",
          "Greenfield Town",
          "Muskogee",
          "Frankfort",
          "Owosso",
          "Mount Pleasant",
          "Statesboro",
          "Marion",
          "Stevens Point",
          "Minot",
          "Shawnee",
          "North Wilkesboro",
          "Richmond",
          "Greeneville",
          "Martinsville",
          "Forest City",
          "Lake City",
          "Kapaa",
          "Marquette",
          "LaGrange",
          "Marion",
          "Morehead City",
          "Marinette",
          "Roswell",
          "Marshall",
          "Farmington",
          "Charleston",
          "Athens",
          "Hobbs",
          "Clearlake",
          "Nacogdoches",
          "Hutchinson",
          "Faribault",
          "Elizabeth City",
          "Ionia",
          "Red Bluff",
          "Hudson",
          "Somerset",
          "Coos Bay",
          "Walla Walla",
          "Sayre",
          "Oneonta",
          "Fort Madison",
          "Baraboo",
          "Marietta",
          "Salina",
          "Rutland",
          "Big Stone Gap",
          "Sturgis",
          "Rio Grande City",
          "Fremont",
          "Mount Vernon",
          "Lewiston",
          "Shelton",
          "Albemarle",
          "Enid",
          "Jefferson",
          "Georgetown",
          "Laconia",
          "Batavia",
          "Oxford",
          "Columbus",
          "Norwalk",
          "Barre",
          "Kinston",
          "Sterling",
          "Palestine",
          "Dublin",
          "Vicksburg",
          "Point Pleasant",
          "Sanford",
          "Fergus Falls",
          "Tiffin",
          "Fairmont",
          "Crossville",
          "Picayune",
          "Gloversville",
          "Gaffney",
          "Carson City",
          "Calhoun",
          "Milledgeville",
          "Waycross",
          "Oil City",
          "Jasper",
          "Morgan City",
          "Eagle Pass",
          "Ontario",
          "Payson",
          "McComb",
          "Rochelle",
          "Scottsboro",
          "Danville",
          "Ashland",
          "Natchez",
          "Greenville",
          "Galesburg",
          "Warrensburg",
          "Kearney",
          "Fort Polk South",
          "Fort Leonard Wood",
          "Glasgow",
          "Athens",
          "Edwards",
          "Fernley",
          "Mason City",
          "Malone",
          "Winona",
          "Durango",
          "Platteville",
          "Boone",
          "Bartlesville",
          "Jacksonville",
          "Elko",
          "Rexburg",
          "St. Marys",
          "Ozark",
          "Amsterdam",
          "Enterprise",
          "Paris",
          "Kerrville",
          "New Castle",
          "Sidney",
          "Cortland",
          "Clinton",
          "Del Rio",
          "Norfolk",
          "Washington",
          "Corsicana",
          "Freeport",
          "Starkville",
          "Burlington",
          "Cadillac",
          "Ardmore",
          "Kendallville",
          "Nogales",
          "Oxford",
          "Bogalusa",
          "Plymouth",
          "Gardnerville Ranchos",
          "Tahlequah",
          "Madisonville",
          "Ruston",
          "Hillsdale",
          "Lewistown",
          "Rockingham",
          "Ponca City",
          "Blytheville",
          "Red Wing",
          "Shawano",
          "Cedar City",
          "Bedford",
          "Gillette",
          "Newport",
          "Wapakoneta",
          "Huntingdon",
          "Bellefontaine",
          "McAlester",
          "Blackfoot",
          "Moultrie",
          "Henderson",
          "Coldwater",
          "Harrison",
          "Rolla",
          "Shelbyville",
          "Duncan",
          "Marion",
          "Lewisburg",
          "Pullman",
          "Thomasville",
          "Bemidji",
          "Mount Sterling",
          "Ottumwa",
          "Pahrump",
          "Menomonie",
          "Selma",
          "Rock Springs",
          "Bucyrus",
          "Bradford",
          "Bardstown",
          "Cornelia",
          "Burley",
          "Greenwood",
          "Big Rapids",
          "Poplar Bluff",
          "Muscatine",
          "Alma",
          "Durant",
          "Seymour",
          "Douglas",
          "Willmar",
          "Auburn",
          "Sedalia",
          "Paragould",
          "Wilmington",
          "Lawrenceburg",
          "Warren",
          "El Dorado",
          "Mountain Home",
          "Cedartown",
          "Port Clinton",
          "El Campo",
          "Montrose",
          "Ellensburg",
          "Jacksonville",
          "Sandpoint",
          "Alice",
          "Celina",
          "Garden City",
          "Marshalltown",
          "Aberdeen",
          "West Plains",
          "Cullowhee",
          "Espa±ola",
          "Riverton",
          "Tifton",
          "Urbana",
          "Cambridge",
          "Okeechobee",
          "McMinnville",
          "Selinsgrove",
          "Natchitoches",
          "Berlin",
          "Lock Haven",
          "Sikeston",
          "Austin",
          "Clewiston",
          "Pittsburg",
          "Defiance",
          "Scottsbluff",
          "Logansport",
          "Pontiac",
          "Hannibal",
          "Mount Vernon",
          "Houghton",
          "Union City",
          "Sault Ste. Marie",
          "Vincennes",
          "Gainesville",
          "Dyersburg",
          "Kill Devil Hills",
          "Crawfordsville",
          "Brownwood",
          "Stephenville",
          "Americus",
          "Easton",
          "North Platte",
          "Newberry",
          "Ada",
          "Moscow",
          "Safford",
          "Murray",
          "Bennington",
          "Huntington",
          "Mayfield",
          "Escanaba",
          "Canton",
          "Corinth",
          "Astoria",
          "Peru",
          "Coshocton",
          "Newton",
          "Logan",
          "Bay City",
          "Fremont",
          "Hutchinson",
          "Batesville",
          "Owatonna",
          "Vidalia",
          "Summit Park",
          "Arkansas City-Winfield",
          "Laramie",
          "Plainview",
          "Big Spring",
          "Laurinburg",
          "Dixon",
          "Alexandria",
          "Newport",
          "DeRidder",
          "Lebanon",
          "Coffeyville",
          "Seneca Falls",
          "Martin",
          "Susanville",
          "Brookhaven",
          "Arcadia",
          "Taylorville",
          "Decatur",
          "Junction City",
          "Effingham",
          "Valley",
          "Butte",
          "Angola",
          "Dodge City",
          "Brenham",
          "Emporia",
          "Jackson",
          "Frankfort",
          "Brevard",
          "Taos",
          "Malvern",
          "Troy",
          "Wabash",
          "Cambridge",
          "Macomb",
          "Vernal",
          "Kingsville",
          "Madison",
          "Mount Pleasant",
          "Paris",
          "Columbus",
          "Brookings",
          "Kennett",
          "Beeville",
          "Miami",
          "Dayton",
          "Washington",
          "Camden",
          "Jackson",
          "Hastings",
          "Juneau",
          "Albert Lea",
          "Lewisburg",
          "Iron Mountain",
          "Lincoln",
          "Jesup",
          "Kirksville",
          "Alpena",
          "Silver City",
          "Elkins",
          "Las Vegas",
          "McPherson",
          "Sheridan",
          "Washington Court House",
          "Bennettsville",
          "Van Wert",
          "Merrill",
          "Ludington",
          "Middlesborough",
          "Crescent City",
          "North Vernon",
          "Hays",
          "Forrest City",
          "Fort Morgan",
          "Mineral Wells",
          "Breckenridge",
          "Bastrop",
          "Bainbridge",
          "Wauchula",
          "Hailey",
          "Great Bend",
          "Weatherford",
          "Watertown",
          "Grants",
          "Thomaston",
          "Mountain Home",
          "Altus",
          "Uvalde",
          "Lexington",
          "Boone",
          "Toccoa",
          "Clarksdale",
          "Summerville",
          "Ottawa",
          "New Ulm",
          "Marshall",
          "La Grande",
          "Greensburg",
          "Mexico",
          "Moberly",
          "The Dalles",
          "Deming",
          "Fallon",
          "Fredericksburg",
          "Magnolia",
          "Campbellsville",
          "Connersville",
          "Dickinson",
          "Spearfish",
          "Heber",
          "Steamboat Springs",
          "Cordele",
          "Marshall",
          "Maryville",
          "Arkadelphia",
          "Liberal",
          "Levelland",
          "Wahpeton",
          "Mitchell",
          "Sterling",
          "Pampa",
          "Yankton",
          "Williston",
          "Oskaloosa",
          "Brookings",
          "Hood River",
          "Beatrice",
          "Borger",
          "Raymondville",
          "Elk City",
          "Dumas",
          "Helena",
          "Price",
          "Port Lavaca",
          "Worthington",
          "Pierre",
          "Evanston",
          "Jamestown",
          "Prineville",
          "Storm Lake",
          "Woodward",
          "Portales",
          "Hereford",
          "Othello",
          "Los Alamos",
          "Fitzgerald",
          "Maysville",
          "Huron",
          "Atchison",
          "Snyder",
          "Fairfield",
          "Spencer",
          "Spirit Lake",
          "Vineyard Haven",
          "Winnemucca",
          "Sweetwater",
          "Andrews",
          "Zapata",
          "Vermillion",
          "Lamesa",
          "Craig",
          "Vernon",
          "Ketchikan"
      ];
      var suggestions = [];
      for (i = 0; i < choices.length; i++)
          if (~choices[i].toLowerCase().indexOf(term)) suggestions.push(choices[i]);
      suggest(suggestions);
  }
});